# 👍 알면 좋은 '코드 리뷰' 노하우 💻

<br />

## 목차

- [코드 리뷰란?](#코드-리뷰란?)
  - [코드 리뷰 특징](#코드-리뷰-특징)
  - [코드 리뷰 목적](#코드-리뷰-목적)
  - [코드 리뷰의 절차](#코드-리뷰의-절차)
  - [좋은 Pull Request 예](#좋은-Pull-Request-예)
  - [코드 리뷰가 어려운 이유](#코드-리뷰가-어려운-이유)

- 기법
  - [효율적인 PR 방법](#효율적인-PR-방법)
  - [효율적인 리뷰 방법](#효율적인-리뷰-방법)
  - [피드백 방법](#피드백-방법)
  - [코드 리뷰 효과](#코드-리뷰-효과)
  - [코드 리뷰를 잘 하기 위해 필요한 기술들](#코드-리뷰를-잘-하기-위해-필요한-기술들)

<br />

> ### 코드 리뷰란?

한 명 또는 여러 명의 개발자가 본인이 만들지 않은 코드의 내용을 점검(examining)하고, 피드백을 주는 과정을 말한다.

여기에서 피드백이란 오타, 버그 가능 성, 개발 표준 등에 대한 의견이 될 수도 있고, 좋은 코드에 대한 긍정적인 피드백이 될 수도 있다.

<br />

> ### 코드 리뷰 특징

- 개발자가 지금부터 당장 행할 수 있는 공유 활동

  - 지식 및 공학적 결정을 공유할 수 있는 기회

  - 코드를 잘 짰던 못 짰던 서로 공유하면서 서로의 지식과 경험을 나누며 상호 학습을 통해 역량 증대 가능


- 배움을 주고 받으며 지속가능한 SW 개발자가 될 수 있는 실천법


- Peer Reviews, Pull Requests, Merge Request 라고도 부름

<br />

> ### 코드 리뷰 목적

- 주목적: 품질 문제 검수(버그, 장애)

  - 알려진 버그나 장애가 없는지 검수하여 올바른 코드가 배포 될 수 있도록 함


- 더 나은 코드 품질 : 아키텍처 속성 개선을 위한 코드 개선(향후 변경 비용 개선)

  -  어떠한 것을 만들었을 때, 그것에 문제가 있다면 나중에 고치는 것 보다 문제를 빠르게 발견해서 빨리 고쳐야 적은시간으로 문제를 고칠 수 있음


- 학습 및 지식 전달 : 코드, 해결책 등과 관련된 지식 공유에 기여

  - 공유(주고 받는 학습)를 통한 역량 증대 및 성장

  - 참여한 모든 사람들의 배움의 기회


- 리뷰어 또한 리뷰 과정에서 지식을 습득(하드스킬, 소프트스킬)

  - 연차가 비슷한 사람들은 하드스킬에 대하여 이야기 할 것인데, 이렇게 되면 개발에 굉장히 구체적인 영역에 관한 이야기가 오고 갈 것 이다.

  - 그런데 기술역량이 뛰어난 시니어가 기술역량이 부족한 주니어에게 무엇인가 알려주고자 하였을 때,
  
    시니어 시점에서 주니어에게 알준다면 주니어는 알아듣거나 습득하는게 굉장히 어려울 것 이다.

  - 따라서 시니어가 소프트스킬을 습득하여 주니어에게 어떤 방식으로 접근하면 좋을지 생각을 해보며 접근 방식에 대해 배울 수 있음


- 동기부여

  - 코드가 잘 짜여진 사람의 리뷰를 보고 자신도 다음엔 그 사람처럼 잘 짜보려는 동기가 부여 될 수 있음


- 상호 책임감 증대

  - 코드리뷰를 통해서 배포를 하게되면 작성자 뿐만 아니라 리뷰어들도 책임감을 갖게 됨

    - 집단 코드 오너십 및 결속 증대

    - 내가 하고 있는 일에 관심을 가짐

    - 팀에서 일어나는 일을 공유할 수 있음 = 팀웍

```
예를들어 한 팀에 다섯가지 일이 주어졌을 때, 두세명씩 그룹을 지어 업무를 처리하거나 각각 하나씩 맡아 업무를 처리할 수 있다.

전자의 경우 같이 일을 하기 때문에 결속 되어 서로 관심을 가지며 팀에서 어떤 일이 생기는지 알 수 있지만,

후자의 경우 각자 맡은 업무만 하기 때문에 결속 되지 않고 팀에 대한 관심도가 떨어질 수 있다.

그러나 코드리뷰를 하게 되면 상대방이 어떤 일을 했는가에 대해 알 수 있고 부족한 부분을 서로 메꾸어 줄 수 있다. 이는 결속 증대와 팀웍으로도 이어지게 된다.
```

- 개발 문화 개선

  - 다른 사람의 개발을 보고 배울 수 있음


- 설계 개선 제안

  - 여러 방법에 대해 제안을 받고 학습하여 코드를 개선해 갈 수 있음
 
<br />

> ### 코드 리뷰의 절차

- 저자(Author)

  - 코드 작성

  - 변경 된 코드에 대해 리뷰 요청


- 리뷰어

  - 코드를 읽고, 머지 가능 여부 결정


- 변경 내역(Change List, Pull Request)

  - 리뷰 시작 전에 작성

  - 저자가 머지를 원하는 소스 코드에 대한 일련의 변경(잘 한것, 아쉬운 것, 눈여겨 볼 것)에 대해 기술

    - 예) 어떤 부분을 변경했고, 이 부분은 좀 아쉽지만 저 부분은 잘 짠 것 같다. 한번 눈여겨 봐달라 등

<br />

<p align="center"><img src="https://user-images.githubusercontent.com/75716255/150318247-a4619336-43ca-4d92-a585-6b2594a5f8f1.png" width="50%" heigh="50%"></p>


<br />

> ### 좋은 Pull Request 예

- 저자가 고생을 하더라도 리뷰어의 시간을 아껴주어야 함

  - description, 간략한 설명 적어주기

  - How to Test, 어떻게 테스트 하면 되는지 커멘드 라인 명령어 알려주기

  - 커밋 메세지 적어 놓기 (빠른 변경 사항 파악 가능)

```
즉, 작은 단위로 쪼개서 리뷰하기 좋게 정리해 주어야 함
```

<br />

> ### 코드 리뷰가 어려운 이유

- 생각을 글로 전달하는 것에 대한 어려움

  - 음성 톤이나 표정의 부재가 생기기 때문에 오해의 위험이 큼 (온라인 코드리뷰 시)


- 저자

  - 본인 생각에 멋진 코드라 생각하고 PR을 보냄


- 리뷰어
  
  - ?? 뭐가 멋짐?

  - 왜 멋지지 않은지에 대한 장황한 이유를 작성


- 결과

  - 코드 토의를 개인적 공격으로 받아 들일 수 있음 => 코드리뷰가 물거품이 됨
  
  - 저자는 코드에 대한 비판을 자신에 대한 비판으로 받아 들임

  - 저자와 리뷰어는 대화가 원활하게 흘러가지 않음


- 해결 법

  - 저자 : 받아들이는 자세 갖기

  - 리뷰어 : 패드백을 조심스럽게 표현

<br />

> 기법

<br />

> ### 효율적인 PR 방법

- 지루한 작업은 컴퓨터로 처리

  - 코드를 읽는 것은 인지적 부담이 되는 고수준의 집중이 요구 되는 작업임

    - 컴퓨터가 할 수 있는 일을 굳이 사람이 할 필요가 없음 => 노력, 시간 낭비

    - 왜? 기계가 사람보다 더 잘 하니까

  - 예) Formatting Tool

    - 공백, 들여쓰기 오류 등

    - 별도의 커밋/PR로 분리 => 리뷰가 필요 없는 부분은 리뷰를 생략할 수 있도록 하기 위해


- 스타일 가이드를 통해 스타일 논쟁을 해소

  - 스타일에 대한 논쟁은 리뷰에서 시간 낭비

    - 방법1. 기존 스타일 방법 채택

    - 방법2. 점진적으로 자신만의 스타일 가이드 만들기

    - 방법3. 방법1 + 방법2


- PR을 올릴 때 주석 달기

  - PR을 저자가 먼저 읽어 보고

  - 리뷰어들을 위한 설명을 커멘트로 남겨서

  - 리뷰어들의 시간을 절약할 수 있게 하기


- 리뷰어에 모두를 포함하기

  - 많은 사람들이 볼 수록 버그를 더 잘 찾아낼 수 있음

  - 많은 사람들이 본다는 것을 알면 사람들은 대게 더 잘 하려는 경향이 있다. (코드 / PR 작성)


- 의미있는 커밋으로 분리

  - 혼자하는 코드 리뷰

    - 단위 별로 쪼개서 커밋

<br />

> ### 효율적인 리뷰 방법

- 리뷰는 즉시 시작 할 것

  - 코드 리뷰는 높은 우선 순위로 하자

    - 저자는 리뷰가 종료될 때 까지 대기(Blocked) 해야 하기 때문


  - 리뷰를 바로 시작하면 선순환이 된다

    - 코드를 읽고 피드백을 줄 때는 시산을 갖고 진행해도 되지만 시작은 바로 하자

    - 이상적으로는 수분 내로 해주는 것이 좋다.


  - 리뷰 라운드의 최대 시간은 하루가 넘지 않도록 하자
    
    - 우선순위 높은 업무로 1일 내 불가하면 다른 리뷰어를 지정해서 리뷰한다.

    - 월 1회이상 재지정을 해야한다면 속도를 줄여서 건강한 개발 관습(Practices)을 유지할 수 있어야 한다.


- 고수준으로 시작해서 저수준으로 내려갈 것

  - 리뷰 라운드에서 많은 의견을 남길 수록, 저자가 당활할 위험이 증가
    
    - 하나의 라운드에 20~50개 정도의 의견은 위험의 시작이 됨


  - 초기 라운드에서는 고수준 피드백으로 제한

    - 버그, 장애, 성능, 보안 등

    - Extract Method, Composed method, Invert-if(복잡도) 등


  - 고수준의 피드백이 처리 된 후에 저수준 이슈를 처리

    - (선택적인) 설계 개선

    - 변수명 변경, 주석을 명확하게 하는 것 등


- 예제 코드 제공에 관대 할 것

  - 저자를 기분 좋게 하기 위한 방법

    - 리뷰 중에 선물 주기(코드 예제)


  - 너무 긴 예제는 관대한 것이 아니라 억압적 으로 보임


  - 라운드 당 2~3개의 코드 예제로 제한

    - 모든 PR에 예제를 제공하면 저자가 코드를 작성할 수 없다고 생각한다는 신호


- 리뷰의 범위를 존중 할 것

  - 자주 보이는 Anti-Pattern

    - PR 근처의 코드를 보고 저자에게 수정을 요청


  - Rule of thumd

    - PR에 포함되지 않은 라인은 리뷰 범위가 아님

    - 포함되지 않은 범위에서 오타가 보이더라도 지적을 하지 않는 것이 좋음

    - 단, 하나의 코드 블럭을 변경 하였을 때 포함되지 않은 범위의 블럭도 같이 변경된다면, 그 범위에 한해서 설명해도 좋음


- 태그를 활용

  - NIT (고쳐도 좋지만 안 고쳐도 그만)

    - 그래도 보통 고침

    - 리뷰어는 항상 더 개선할 수 있는 의견을 자유롭게 남길 수 있어야 함

    - 중요하지 않다면 "NIT"를 태그로 남겨서 저자가 무시할 수 있도록 할 수 있음

    - 교육적인 목적이나 기술자들이 지속적으로 기술을 연마하는 것을 돕는 것이 목적임

      - 예를 들어 ) nit : null 대신 Optional을 쓰면 어떨까요?


- 한두 등급만 코드 레벨을 올리는 것을 목표로 할 것

  - D 등급의 PR을 받으면 저자가 C나 B등급을 받도록 도울 것

    - letter grade

    - 완전하지는 않아도 좋은 코드가 되도록 할 것


  - F

    - 기능적으로 틀렸거나 너무 복잡해서 정합성에 확신이 없는 상태

    - 수 차례의 리뷰 후에도 승인을 보류하는 유일한 이유

<br />

> ### 피드백 방법

- '너' 라는 말 사용 금지


- 건설적인 피드백 하기

  - 동료간의 피드백은 경쟁을 유발하려고 하는 것이 아님, 팀의 생산성을 높이기 위해 하는 것임

  - 건설적인 피드백은 개발자들이 그들의 실수에서 배우고 역량을 증대하도록 동기부여를 심어줌

  - 건설적인 피드백을 못 하겠다면 그냥 피드백을 주지 말자.


- 진정한 칭찬 하기

  - 진심어린 칭찬은 리뷰어가 잔인한 감시자가 아닌 팀동료를 도와주려는 것으로 보여서 저자의 긴장감을 낮춰줌


- 명령이 아니라 요청으로 하기
  
  - ~할 수 있을까요?

  - ~괜찮을까요?


- 의견이 아니라 원칙에 기반하여 하기

  - 저자에게 의견을 줄땐 '제안하는 변경'과 '변경의 이유'를 모두 설명할 것


- 반복적인 패턴에 대해 피드백을 제한 하기

  - 저자의 실수가 동일한 패턴임을 식별 했다면 모든 경울를 언급하지 말것

  - 동일 패턴에 대해 2~3개 정도의 예를 언급할 것

  - 그 이상은 저자에게 개별 사례가 아니라 패턴에 대해서 수정을 요구할것


- 교착 상태를 적극적으로 처리할것

  - 교착 상태로 향하는지 아는 방법

    - 토론의 톤이 점차 팽팽해지고 공격적으로 됨

    - 라운드당 커멘트가 줄어들지 않음

    - 커멘트에 저항이 보임


- 결과

  - 커멘트를 반영하지 않으니 승인 거부


- 해결 법

  - 만나서 얘기 할 것 => 텍스트 기반 의사소통은 상대가 인간이라는 것을 잊게 함

  - 저자와 짝 프로그래밍을 하여 개선 방안을 보여주고, 스스로 개선 할 수 있도록 기회를 줌

<br />

> ### 코드 리뷰 효과

- 예상치 못한 버그를 타 프로젝트에서 발견하기도 함

- PR 전에 코드를 한번 더 다듬게 됨

- 좋은 설계, 아키텍처, 클린코드, TDD 등에 대한 공감대/열정 형성

<br />

> ### 코드 리뷰를 잘 하기 위해 필요한 기술들

- 리팩토링

  - 결과의 변경 없이 코드의 구조를 재조정 함

    - 가독성을 높이고 유지보수를 편한게 해줌

    - 단, 버그를 없애거나 새로운 기능을 추가하는 행위는 아님


  - TDD + 리팩토링

    - 돌아가는 코드를 가지고 설계를 함


  - 매일 리팩토링

    - Composed Method

    - 응집도 높이기


- 레거시 코드 다루기

  - 의존성 관리 (Subclass & Override Method)

  - 테스트 추가 (Characterization Test)

  - 새로운 코드 빠르게 추가 (Surport/Wrap, Method/Class)


- 클린 코드 & TDD
